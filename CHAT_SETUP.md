# Налаштування чату з підтримкою

## Крок 1: Створення таблиць в Supabase

1. Відкрийте Supabase Dashboard
2. Перейдіть до SQL Editor
3. Виконайте SQL скрипт з файлу `supabase-chat-schema.sql`:

```sql
-- Скопіюйте весь вміст файлу supabase-chat-schema.sql та виконайте в SQL Editor
```

Або виконайте команду:

```bash
# Якщо у вас встановлений Supabase CLI
supabase db push
```

## Крок 2: Перевірка таблиць

Після виконання SQL скрипту переконайтеся, що створені таблиці:
- `conversations` - для зберігання розмов
- `messages` - для зберігання повідомлень

## Крок 3: Налаштування RLS (Row Level Security)

RLS політики вже налаштовані в SQL скрипті, але переконайтеся, що:
- RLS увімкнено для обох таблиць
- Політики правильно налаштовані для користувачів та адмінів

## Крок 4: Перевірка змінних оточення

Переконайтеся, що в `.env` файлі є:
```env
SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
```

## Використання

### Для користувачів:
1. Перейдіть до профілю
2. Знайдіть секцію "Support Chat"
3. Створіть нову розмову або виберіть існуючу
4. Напишіть повідомлення та відправте

### Для адмінів:
1. Перейдіть до Admin Dashboard
2. Виберіть вкладку "Support"
3. Виберіть розмову зі списку
4. Відповідайте на повідомлення користувачів
5. Можете закривати розмови кнопкою "Close"

## API Endpoints

- `GET /api/chat/conversations` - отримати всі розмови
- `POST /api/chat/conversations` - створити нову розмову
- `GET /api/chat/messages?conversationId=...` - отримати повідомлення
- `POST /api/chat/messages` - відправити повідомлення
- `PATCH /api/chat/conversations/[id]` - оновити розмову (тільки для адмінів)

## Примітки

- Повідомлення оновлюються автоматично через polling (кожні 2-3 секунди)
- Для production рекомендовано використати Supabase Realtime для live оновлень
- RLS політики забезпечують безпеку даних

