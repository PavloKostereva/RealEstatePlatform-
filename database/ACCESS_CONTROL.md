# Обмеження доступу до моделей (Access Control)

## Огляд

Всі моделі в базі даних мають обмеження доступу на рівні API routes. "Unrestricted" в Prisma Studio означає, що моделі доступні для перегляду через Prisma Studio, але всі операції через API захищені авторизацією.

## Обмеження доступу по моделях

### 1. **User** (Користувачі)
- ✅ **GET /api/users/[id]** - Авторизовані користувачі можуть переглядати будь-якого користувача
- ✅ **PUT /api/users/profile** - Користувачі можуть редагувати тільки свій профіль
- ✅ **POST /api/users/[id]/verify-owner** - Тільки ADMIN може підтверджувати власників
- ❌ **DELETE** - Тільки ADMIN може видаляти користувачів

### 2. **Listing** (Оголошення)
- ✅ **GET /api/listings** - Всі можуть переглядати опубліковані оголошення (PUBLISHED)
- ✅ **GET /api/listings/[id]** - Всі можуть переглядати опубліковані оголошення
- ✅ **POST /api/listings** - Авторизовані користувачі можуть створювати оголошення (статус: PENDING_REVIEW)
- ✅ **PUT /api/listings/[id]** - Власники можуть редагувати свої оголошення, ADMIN - всі
- ✅ **DELETE /api/listings/[id]** - Власники можуть видаляти свої оголошення, ADMIN - всі
- ❌ **Статус PUBLISHED** - Тільки ADMIN може змінювати статус на PUBLISHED

### 3. **SavedListing** (Улюблені)
- ✅ **GET /api/saved** - Користувачі можуть переглядати тільки свої улюблені
- ✅ **POST /api/saved/[id]** - Користувачі можуть додавати тільки свої улюблені
- ✅ **DELETE /api/saved/[id]** - Користувачі можуть видаляти тільки свої улюблені
- ❌ **Доступ до чужих улюблених** - Заборонено (403 Forbidden)

### 4. **Message** (Повідомлення)
- ✅ **GET /api/messages** - Користувачі можуть переглядати тільки свої повідомлення (відправлені/отримані)
- ✅ **POST /api/messages** - Авторизовані користувачі можуть відправляти повідомлення
- ✅ **PUT /api/messages/[id]** - Отримувачі можуть оновлювати свої отримані повідомлення
- ❌ **Доступ до чужих повідомлень** - Заборонено (403 Forbidden)

### 5. **Review** (Відгуки)
- ✅ **POST /api/reviews** - Авторизовані користувачі можуть залишати відгуки
- ✅ **Один відгук на оголошення** - Користувач може залишити тільки один відгук (upsert)
- ❌ **Видалення відгуків** - Тільки ADMIN може видаляти відгуки

## Ролі користувачів

### USER (Звичайний користувач)
- Може переглядати опубліковані оголошення
- Може створювати оголошення (статус: PENDING_REVIEW)
- Може редагувати/видаляти свої оголошення
- Може додавати/видаляти улюблені
- Може відправляти повідомлення
- Може залишати відгуки
- Може редагувати свій профіль

### OWNER (Власник)
- Всі права USER
- Може створювати більше оголошень
- Потребує підтвердження від ADMIN (ownerVerified)

### ADMIN (Адміністратор)
- Повний доступ до всіх моделей
- Може змінювати статус оголошень на PUBLISHED
- Може підтверджувати власників
- Може видаляти будь-які дані
- Може переглядати всі повідомлення та улюблені

## Безпека

- Всі API routes захищені авторизацією через NextAuth
- Перевірки ролей на рівні API routes
- Користувачі не можуть доступатися до чужих даних
- Всі операції логуються для аудиту

## Примітка про Prisma Studio

"Unrestricted" в Prisma Studio - це нормально для розробки. Prisma Studio - це інструмент для розробників, і він не має вбудованих обмежень доступу. Обмеження доступу реалізовані на рівні API routes, тому навіть якщо в Prisma Studio показано "Unrestricted", всі операції через API захищені.

