# SQL Schema для Real Estate Platform

## Опис таблиць

### 1. **User** (Користувачі)

Зберігає інформацію про користувачів системи:

- `id` - унікальний ідентифікатор (UUID)
- `email` - електронна пошта (унікальна)
- `password` - хеш пароля
- `name` - ім'я користувача
- `phone` - телефон
- `avatar` - URL аватара
- `role` - роль (USER, OWNER, ADMIN)
- `ownerVerified` - чи підтверджено власника
- `createdAt`, `updatedAt` - дати створення та оновлення

**Обмеження доступу:**

- Користувачі можуть переглядати тільки свої дані
- Адміністратори можуть переглядати всіх користувачів
- Тільки адміністратори можуть змінювати ролі та підтверджувати власників

### 2. **Listing** (Оголошення нерухомості)

Зберігає оголошення про нерухомість:

- `id` - унікальний ідентифікатор
- `title` - назва оголошення
- `description` - опис
- `type` - тип (RENT - оренда, SALE - продаж)
- `category` - категорія (APARTMENT, HOUSE, COMMERCIAL)
- `price` - ціна
- `currency` - валюта (за замовчуванням UAH)
- `address` - адреса
- `latitude`, `longitude` - координати на карті
- `area` - площа
- `rooms` - кількість кімнат
- `images` - масив URL зображень
- `amenities` - масив зручностей
- `availableFrom`, `availableTo` - дати доступності
- `status` - статус (DRAFT, PENDING_REVIEW, PUBLISHED, ARCHIVED)
- `views` - кількість переглядів
- `ownerId` - ID власника (зв'язок з User)
- `createdAt`, `updatedAt` - дати

**Обмеження доступу:**

- Всі можуть переглядати опубліковані оголошення (PUBLISHED)
- Власники можуть створювати, редагувати та видаляти свої оголошення
- Нові оголошення автоматично отримують статус PENDING_REVIEW
- Тільки адміністратори можуть змінювати статус на PUBLISHED
- Власники можуть редагувати тільки свої оголошення
- Адміністратори можуть редагувати всі оголошення

### 3. **SavedListing** (Улюблені оголошення)

Зберігає улюблені оголошення користувачів:

- `id` - унікальний ідентифікатор
- `userId` - ID користувача
- `listingId` - ID оголошення
- `createdAt` - дата додавання
- Унікальна комбінація `userId` + `listingId`

**Обмеження доступу:**

- Користувачі можуть додавати/видаляти тільки свої улюблені
- Користувачі можуть переглядати тільки свої улюблені
- Адміністратори можуть переглядати всі улюблені

### 4. **Message** (Повідомлення)

Зберігає повідомлення між користувачами:

- `id` - унікальний ідентифікатор
- `subject` - тема повідомлення
- `content` - вміст повідомлення
- `read` - чи прочитано
- `senderId` - ID відправника
- `receiverId` - ID отримувача
- `listingId` - ID оголошення (опціонально)
- `createdAt` - дата створення

**Обмеження доступу:**

- Користувачі можуть переглядати тільки свої повідомлення (відправлені або отримані)
- Користувачі можуть відправляти повідомлення
- Отримувачі можуть позначати повідомлення як прочитані
- Адміністратори можуть переглядати всі повідомлення

### 5. **Review** (Відгуки)

Зберігає відгуки та рейтинги на оголошення:

- `id` - унікальний ідентифікатор
- `rating` - рейтинг (1-5)
- `comment` - коментар
- `userId` - ID користувача
- `listingId` - ID оголошення
- `createdAt`, `updatedAt` - дати
- Унікальна комбінація `userId` + `listingId`

**Обмеження доступу:**

- Всі авторизовані користувачі можуть залишати відгуки
- Користувач може залишити тільки один відгук на оголошення
- Користувачі можуть редагувати свої відгуки
- Адміністратори можуть видаляти будь-які відгуки

## Як використовувати

### Варіант 1: Через Prisma (рекомендовано)

```bash
npm run db:generate
npm run db:push
```

### Варіант 2: Через SQL напряму

```bash
# Підключіться до PostgreSQL
psql -U your_user -d your_database

# Виконайте SQL скрипт
\i database/schema.sql
```

Або через командний рядок:

```bash
psql -U your_user -d your_database -f database/schema.sql
```

## Примітки

- Всі таблиці мають автоматичне оновлення `updatedAt` через тригери
- Всі зовнішні ключі мають `ON DELETE CASCADE` для автоматичного видалення залежних записів
- Створені індекси для швидкого пошуку
- Enum типи для типізації даних
- Обмеження доступу реалізовані на рівні API routes

## Безпека

- Всі API routes захищені авторизацією
- Користувачі можуть доступатися тільки до своїх даних
- Адміністратори мають повний доступ
- Нові оголошення потребують підтвердження адміністратора
